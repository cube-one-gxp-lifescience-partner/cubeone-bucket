{
    "version": "1.8.00.17054",
    "description": "Microsoft Teams (New App) - Direct installer",
    "homepage": "https://www.microsoft.com/microsoft-teams/download-app",
    "license": "Proprietary",
    "url": "https://statics.teams.cdn.office.net/evergreen-assets/DesktopClient/MSTeamsSetup.exe",
    "installer": {
        "args": ["/S"],
        "keep": true
    },
    "post_install": [
        "Write-Host 'Teams installed successfully!' -ForegroundColor Green",
        "Write-Host 'Setting up GPU fix...' -ForegroundColor Yellow",
        "[Environment]::SetEnvironmentVariable('WEBVIEW2_ADDITIONAL_BROWSER_ARGUMENTS', '--disable-gpu --disable-software-rasterizer', 'User')",
        "New-Item -Path 'HKCU:\\Software\\Microsoft\\Teams' -Force -ErrorAction SilentlyContinue",
        "Set-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Teams' -Name 'DisableHardwareAcceleration' -Value 1 -Type DWord -ErrorAction SilentlyContinue",
        "Write-Host 'GPU acceleration disabled!' -ForegroundColor Green"
    ],
    "uninstaller": {
        "script": [
            "Write-Host 'Uninstalling Teams...' -ForegroundColor Yellow",
            "# Teams über winget deinstallieren",
            "winget uninstall Microsoft.Teams --silent --accept-source-agreements 2>$null",
            "# Teams über normale Deinstallation",
            "$uninstallKeys = @(",
            "    'HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*',",
            "    'HKLM:\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*',",
            "    'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*'",
            ")",
            "foreach ($key in $uninstallKeys) {",
            "    Get-ItemProperty -Path $key -ErrorAction SilentlyContinue | Where-Object { $_.DisplayName -like '*Teams*' } | ForEach-Object {",
            "        if ($_.UninstallString -and (Test-Path $_.UninstallString.Split(' ')[0])) {",
            "            Write-Host \"Found Teams: $($_.DisplayName)\" -ForegroundColor Cyan",
            "            if ($_.UninstallString -like '*msiexec*') {",
            "                Start-Process -FilePath 'msiexec' -ArgumentList '/x', $_.PSChildName, '/quiet' -Wait -NoNewWindow -ErrorAction SilentlyContinue",
            "            } else {",
            "                $exe = $_.UninstallString.Split(' ')[0]",
            "                Start-Process -FilePath $exe -ArgumentList '/S' -Wait -NoNewWindow -ErrorAction SilentlyContinue",
            "            }",
            "        }",
            "    }",
            "}",
            "# Aufräumen",
            "Remove-Item -Path 'HKCU:\\Software\\Microsoft\\Teams' -Force -Recurse -ErrorAction SilentlyContinue",
            "[Environment]::SetEnvironmentVariable('WEBVIEW2_ADDITIONAL_BROWSER_ARGUMENTS', $null, 'User')",
            "Write-Host 'Teams uninstalled!' -ForegroundColor Green"
        ]
    },
    "checkver": {
        "script": [
            "$url = 'https://statics.teams.cdn.office.net/evergreen-assets/DesktopClient/MSTeamsSetup.exe'",
            "$tempFile = New-TemporaryFile",
            "try {",
            "    Invoke-WebRequest -Uri $url -OutFile $tempFile -UseBasicParsing",
            "    $fileInfo = Get-Item $tempFile",
            "    $version = $fileInfo.VersionInfo.ProductVersion",
            "    if (!$version) {",
            "        $hash = (Get-FileHash $tempFile -Algorithm SHA256).Hash",
            "        $version = $hash.Substring(0,8)",
            "    }",
            "    Write-Output $version",
            "} catch {",
            "    Write-Output (Get-Date -Format 'yyyy.MM.dd.HHmm')",
            "} finally {",
            "    Remove-Item $tempFile -ErrorAction SilentlyContinue",
            "}"
        ]
    },
    "autoupdate": {
        "url": "https://statics.teams.cdn.office.net/evergreen-assets/DesktopClient/MSTeamsSetup.exe"
    }
}
