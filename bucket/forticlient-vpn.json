{
    "version": "1.0.0",
    "description": "FortiClient VPN - SSL VPN client for secure remote access",
    "homepage": "https://git.cubeone.de/marvin.fenssel/auto-updater",
    "license": "Proprietary",
    "url": "https://httpbin.org/robots.txt",
    "pre_install": [
        "# Lösche die Dummy-Datei",
        "Remove-Item \"$dir\\robots.txt\" -ErrorAction SilentlyContinue",
        "",
        "# Prüfe GitLab PAT",
        "if (-not $env:GITLAB_PAT) {",
        "    throw 'GITLAB_PAT environment variable not set'",
        "}",
        "",
        "Write-Host 'Downloading FortiClient VPN from cube one GitLab API...' -ForegroundColor Blue",
        "",
        "# GitLab API Headers",
        "$headers = @{",
        "    'Authorization' = \"Bearer $env:GITLAB_PAT\"",
        "    'User-Agent' = 'cube-one-auto-updater/1.0'",
        "}",
        "",
        "# GitLab API URL",
        "$apiUrl = 'https://git.cubeone.de/api/v4/projects/marvin.fenssel%2Fauto-updater/repository/files/additional_software%2FFortiClientVPN.exe/raw?ref=main'",
        "$downloadPath = \"$dir\\FortiClientVPN.exe\"",
        "",
        "try {",
        "    Invoke-WebRequest -Uri $apiUrl -Headers $headers -OutFile $downloadPath -TimeoutSec 30",
        "    ",
        "    if (Test-Path $downloadPath) {",
        "        $fileInfo = Get-Item $downloadPath",
        "        Write-Host \"Download successful: $($fileInfo.Length) bytes\" -ForegroundColor Green",
        "        ",
        "    } else {",
        "        throw 'Downloaded file not found'",
        "    }",
        "} catch {",
        "    throw \"Failed to download from GitLab API: $($_.Exception.Message)\"",
        "}",
        "",
        "Write-Host 'FortiClient VPN downloaded successfully!' -ForegroundColor Green"
    ],
    "installer": {
        "script": [
            "Rename-Item -Path \"$dir\\FortiClientVPN.exe\" -NewName \"FortiClientVPN.msi\" -Force",
            "Write-Host 'Installing FortiClient VPN...' -ForegroundColor Green",
            "$msiPath = \"$dir\\FortiClientVPN.msi\"",
            "Write-Host \"Executing: msiexec /i `\"$msiPath`\" /passive /norestart\" -ForegroundColor Cyan",
            "$process = Start-Process -FilePath 'msiexec' -ArgumentList '/i', \"`\"$msiPath`\"\", '/passive', '/norestart' -Wait -PassThru -NoNewWindow",
            "switch ($process.ExitCode) {",
            "    0 { Write-Host 'FortiClient VPN installed successfully!' -ForegroundColor Green }",
            "    3010 { Write-Host 'FortiClient VPN installed successfully! (Reboot recommended)' -ForegroundColor Green }",
            "    1641 { Write-Host 'FortiClient VPN installed successfully! (Reboot initiated)' -ForegroundColor Green }",
            "    default {",
            "        Write-Host \"Installation failed with exit code: $($process.ExitCode)\" -ForegroundColor Red",
            "        exit $process.ExitCode",
            "    }",
            "}"
        ]
    },
    "post_install": [
        "Write-Host 'FortiClient VPN installation completed from cube one GitLab!' -ForegroundColor Green",
        "Write-Host 'Source: https://git.cubeone.de/marvin.fenssel/auto-updater' -ForegroundColor Blue",
        "Write-Host 'Note: A reboot may be required for full functionality.' -ForegroundColor Yellow"
    ],
    "uninstaller": {
        "script": [
            "Write-Host 'Uninstalling FortiClient VPN...' -ForegroundColor Yellow",
            "Get-Process -Name 'FortiClient*' -ErrorAction SilentlyContinue | Stop-Process -Force -ErrorAction SilentlyContinue",
            "$uninstallKeys = @(",
            "    'HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*',",
            "    'HKLM:\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*'",
            ")",
            "foreach ($key in $uninstallKeys) {",
            "    Get-ItemProperty -Path $key -ErrorAction SilentlyContinue | Where-Object { $_.DisplayName -like '*FortiClient*' } | ForEach-Object {",
            "        Write-Host \"Uninstalling: $($_.DisplayName)\" -ForegroundColor Cyan",
            "        $productCode = $_.PSChildName",
            "        $process = Start-Process -FilePath 'msiexec' -ArgumentList '/x', $productCode, '/passive', '/norestart' -Wait -PassThru -NoNewWindow",
            "        switch ($process.ExitCode) {",
            "            0 { Write-Host \"Successfully uninstalled: $($_.DisplayName)\" -ForegroundColor Green }",
            "            3010 { Write-Host \"Successfully uninstalled: $($_.DisplayName) (Reboot recommended)\" -ForegroundColor Green }",
            "            1605 { Write-Host \"Product not found (already uninstalled): $($_.DisplayName)\" -ForegroundColor Yellow }",
            "            default { Write-Host \"Uninstall failed with exit code: $($process.ExitCode)\" -ForegroundColor Red }",
            "        }",
            "    }",
            "}",
            "Write-Host 'FortiClient VPN uninstall completed!' -ForegroundColor Green"
        ]
    },
    "notes": [
        "FortiClient VPN from cube one GmbH",
        "Downloaded from private GitLab repository via API",
        "Requires GITLAB_PAT environment variable for authentication",
        "Installs as system-wide MSI package with /passive /norestart"
    ]
}
